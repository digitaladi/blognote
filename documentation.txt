

        cr√©er le projet symfony 
symfony new my_project_directory --version="7.1.*" --webapp


en cas de probl√©mes de, de conflits de ports dans le container on relance le moteur docker
        service docker restart
 

pour stopper et supprimer tous les containers :
      docker rm -f $(docker ps -aq)


supprimer tous images en meme temp
        docker rmi $(docker images -q)

Commande pour acc√©der au shell du container php-fpm
docker compose exec php-fpm  /bin/bash


lien pour la gestion les images et containers: https://www.hostinger.fr/tutoriels/supprimer-toutes-les-images-docker#:~:text=Pour%20supprimer%20plusieurs%20images%20Docker,images%20que%20vous%20souhaitez%20supprimer.&text=La%20commande%20docker%20images%20%2Dq,supprime%20toutes%20vos%20images%20Docker.



un conseil : √©x√©cuter vos commandes dans le container


1 - Pour cr√©er un controller 

symfony console  make:controller

Cette commande  src/Controller/MainController.php et templates/main/index.html.twig



le css se troue dans assets/styles/app.css









pour acceder au settings et faire des configs du cot√© graphique...
 ctrl + shift + p

....il est possible de faire les configs du cot√© fichier en cliquant sur l'icone fichier


pour trouver le namespace d'un objet, fuction ou class
ctrl + alt + i 





//EXTENSIONS VISUAL STUDIO A INSTALLER SUR SYMFONY :  

1. PHP Intelephense
2. PHPDoc Comment
3. PHP Namespace Resolver
4. Symfony code snippets
5. Symfony for VSCode
6. Symfony Snippets
7. Twig
8. Twig Language 2
9. HTML CSS Support
10. Twig
11. JavaScript (ES6) code snippets
12. Community Material Theme (Extra)
13. French Language Pack for Visual Studio Code
14. Live Sass Compiler

NB: voir ce lien : https://blog.codewithdary.com/must-have-vscode-extensions-for-symfony




    

_________________ AssetMapper : gestion CSS et JS simple et moderne   _________________
  

  Il est installer par default sur symfony sinon si ce n'est pas le cas voila la commande √† taper
Pour installer le composant AssetMapper, ex√©cutez :

        composer require symfony/asset-mapper symfony/asset symfony/twig-pack

        voila le r√©sultat : 
        assets/app.js Votre fichier JavaScript principal ;
        assets/styles/app.css Votre fichier CSS principal ;
        config/packages/asset_mapper.yaml O√π vous d√©finissez vos ¬´ chemins ¬ª d‚Äôactifs ;
        importmap.php Votre fichier de configuration importmap.


importmap() permet de linker notre application √† nos fichiers de css et js 'app' concerne le app.js.
c'est le point d'entr√©e de nos fichiers css et js
 {% block importmap %}{{ importmap('app') }}{% endblock %}





_________________ CREATION DE LA BASE DE DONNEES   _________________
  
cr√©ation de l'entit√© user pour authentification

         symfony console make:user
resultat : 
 created: src/Entity/User.php
 created: src/Repository/UserRepository.php
 updated: src/Entity/User.php
 updated: config/packages/security.yaml


 on va ajouter des attributs √† notre entit√© user
        symfony console make:entity




on fait la meme chose avec l'entity  :  
        Keyword
        Category
        Trick
        Comment
        rating

les relations :

        - les asctuces (tricks) ne peuvent pas avoir q'un seul user
        - peuvent avoir plusieurs mots-cl√©s (Keyword) et les Keyword peuvent avoir plusierus asctuces
        - un Trick peut avoir plusieurs comments et un comment ne peut aprtenir qu'un seul post et seul user
        - un trick peut avoir plusieurs rating mais un rating ne peu appartenir  qu'un seul trick

une fois les entit√©s finis : 

on cr√©e les requetes : 
        symfony console make:migration

si touche se passe bien un fichier de migration sera cr√©e dans le dossier migrations qui contient toutes les requetes li√©es aux entit√©s

pour le faire correspondre √† notre base de donn√©es on fait : 


symfony console doctrine:migrations:migrate


et la tous nos tables et leurs colonnes sont cr√©es

Pour supprimer touta la base de donn√©es et refaire la migration
        symfony console d:d:d --force 

pour r√©ecrer la base de donn√©es
        symfony console d:d:c 



_________________   AUTHENTIFICATION   _________________
faire L'authentification

        symfony console make:auth  

...suivre les instructions

voila ce qui a √©t√© cr√©e : 

        created: src/Security/UserAuthentificatorAuthenticator.php
        updated: config/packages/security.yaml
        created: src/Controller/SecurityController.php
        created: templates/security/login.html.twig

...lire les instructions qui suivent





faire l'inscription : 
        symfony console make:registration

voila le r√©sultat : 

 updated: src/Entity/User.php
 created: src/Form/RegistrationFormType.php
 created: src/Controller/RegistrationController.php
 created: templates/registration/register.html.twig


...lire les instructions qui suivent







_________________   ENVOIE DE MAIL  _________________

on va simuler un envoie de mail avec mailhog avec docker

on √©xc√©cute docker compose pour cr√©er un nouveau container enfin que l'image soit pris en compte

aller dans .env.local decommenter cette ligne et configurer comme ceci : 
        MAILER_DSN=smpt://mailhog:1025


puis aller dans configs/packages/messenger.yaml et decommenter cette ligne : 
        #Symfony\Component\Mailer\Messenger\SendEmailMessage: async

cela permet d'ignorer le systeme par defaults de symfony qui permet d'envoyer des mails


et si vous voulez mettre un syst√©me fil d'attente il faut d√©commenter cette ligne


Je vais dans env.local pour cr√©er un cl√© token qui me permet d'activer mon compte si j'envoie le mail
JWT_SECRET = 'messiTheGreatest'


pour acceder √† JWT_SECRET dans notre controller ex il faut aller le d√©clarer dans config/services.yaml dans les parameters : 
          app.jwtsecret: '%env(JWT_SECRET)'


donc pour envoyer l'email il faut aller dans la fonction register (fonction pour s'enregistrer) dans le controller RegistrationController
        - generer le tocken
        - envoyer le mail 








aller dans src cr√©er un dossier services pour y mettre mes services 
apr√®s s'y met s'y cr√©e le service SendEmailService.php

pour le template de l'email d' inscription on cr√©e un dossier emails dans templates et on y cr√©e le fichier register.html.twig



on va cr√©er un service JWTService.php

on va cr√©er 
        - la fonction qui g√©n√©re le token
        - fonction qui v√©rifie si le token est valide
        - fonction qui r√©cup√©re le Payload
        - fonction qui r√©cup√©re le header
        - fonction qui v√©rifie si le token a expir√©
        - fonction qui v√©rifie la signature du Token

apr√®s inscription :
        - on g√©n√©re le token
        - et envoie le mail





activer le compte si on on clique sur un lien dans le mail d'inscription







_________________   MOT DE PASSE OUBLIE  _________________

cr√©er une  : 
- fonction forgottenPassword dans le controller SecurityController : permet d'acceder √† une page d'envoie de mail √† l'utilisateur pour r√©ntialiser le mdp
- le template  reset_password_request.html.twig qui va recevoir l'email de d'envoie de renitialisation de mdp
- une template email password_reset.html.twig : qui va recevoir le lien pour r√©initialiser le mdp
- Cr√©er un formulaire avec comme champ l'email : ResetPasswordRequestFormType.php

- Cr√©er la fonction resetPassword dans le controller SecurityController permet de r√©initialiser le mdp
- cr√©er un formulaire avec un champ password pour 







_________________   CREATION  CONTROLLER ET FORMULAIRE POUR D AUTRES ENTITES  _________________


pour cr√©er un formulaire
         symfony console make:form 



cr√©ation controller (dans Admin/..) et formType de : 
        - keywordsController
        - KeywordFormType





        - CategorieController
        - KeywordFormType






NB : une relation dans une meme table ex: categorie
c'est √†  dire une cat√©gorie peut avoir une cat√©gorie






creation du controller trick (astuce) (dans Profil/..) 

- TrickController
- AddTrickFormType













______________________________ LES DATAFIXTURES ____________________

on isntall nos fixtures
        composer require --dev orm-fixtures

resultat : 
un dossier Datafixtures est cr√©e dans /src


on supprime les tables de notre base de donn√©es apr√®s :
on refait 
        - On supprime le fichier migration dans le dossier migration 
on lance : 
        - symfony console make:migration  (pour cr√©er nos requetes √† partir des entit√©s et g√©n√©re un nouveau fchier de migration dans le dossier de migration)

        - symfony console doctrine:migrations:migrate (avec les requetes du fichier de migration on cr√©e nos tables)






avec nos Datafixtures on va cr√©er des enregsitrements √† la vol√©e


pour chaque entit√© on aura un fixture :
on va cr√©er pour Keyword KeywordFixtures

pour lancer les fixtures de keyword
symfony console d:f:l










______________________________ LES CONSTRAINTES ____________________

les constraintes de l'entit√© 

les donn√©es sont v√©rifi√©s avant d' etre stock√©s dans la base alors que les contraintes de formulaire ne s'ocupent que les don√©es rentr√©s dans le formulaire

la class qui s'occupe des constraintes : 
use Symfony\Component\Validator\Constraints as Assert;

une contrainte sur un champs email exemple :  
1er param de la fonction Assert\Email : une cl√©/valeur = messeage:erreur

    #[Assert\Email(
        message: 'The email {{ value }} is not a valid email.',
    )]
    protected string $email;





on peut aussi faire des contraintes de formulaire : ex : 

                'constraints' => [
                    new NotBlank([
                        'message' => 'Please enter a password',
                    ]),
                    new Length([
                       // 'min' => 6,
                        'minMessage' => 'Your password should be at least {{ limit }} characters',
                        // max length allowed by Symfony for security reasons
                        'max' => 4096,
                    ]),
                ],









_________________________________  R√®gles d‚Äôentropie des mots de passe  __________________________________

mettre en place dans le fichier assets/js/register.js




_________________________________   Upload d'Images et Redimensionnement  __________________________________
mettre dans 
cr√©er un dossier d'Upload en parameters dans le fichier services.yaml


cr√©er un service pour l'Upload et Redimensionnement
PictureService.php


- Affichage de l'image apr√®s ajout en js et ajax





//installer les icones symfony ux
composer require symfony/ux-icons

//pour voir  les informations sur les icones existants : symfony console ux:icons:search

on pr√©fixe par  ex  "fa"
il t'affiche tous les set icon: 

//on pr√©fixe par  ex  "tabler"
il affiche le nombre de icons




//si on veut trouver des icones sur un theme user exemple : 
symfony console ux:icons:search tabler user : 


 tabler:user                                tabler:user-bitcoin                       
  tabler:user-bolt                           tabler:user-cancel                        
  tabler:user-check                          tabler:user-circle                        
  tabler:user-code                           tabler:user-cog                           
  tabler:user-dollar                         tabler:user-down                          
  tabler:user-edit                           tabler:user-exclamation                   
  tabler:user-filled                         tabler:user-heart                         
  tabler:user-hexagon                        tabler:user-minus                         
  tabler:user-off                            tabler:user-pause                         
  tabler:user-pentagon                       tabler:user-pin  






et vous ajouter comme par magie ce code dans votre twig et √ßa marche: 
	{{ ux_icon('tabler:user-circle') }}


aller sur le site :  https://ux.symfony.com/icons


lien pour tuto : https://www.youtube.com/watch?v=VkNNhap-CBc






                                                


<!-- <div class="checkbox mb-3"><label><input type="checkbox" name="_remember_me">Se souvenir de moi</label></div>-- >




Cr√©er une function twig 




____________________________________

installation de composer require vich/uploader-bundle





serialiser les colonnes id, username et password




pour le recaptcha
le lien pour des recaptcha : https://www.youtube.com/watch?v=Y_X1_hXZGEs&list=PLUiuGjup8Vg5t20nu7aaJDnbHlhzXbbuN&index=23
composer require karser/karser-recaptcha3-bundle

un fichier  karser_recaptcha3 qui contient le config



_______________________________________________________

Une commande pour cr√©er un administrateur
Le but de cette fonctionnalit√© est de pouvoir cr√©er en ligen de commande.
Cela permettra d'ajouter des administrateurs

Une commande permet d'ex√©cuter un code en ligne de commande avec une instruction


pour cr√©er la commdande : symfony console make:command

puis vous mettez : app:nom_de_commande

Une fois fais il cr√©e un dossier Command dans lequel se trouve un fichier CreateAdministratorCommand.php

CreateAdministratorCommand.php qui sera √©x√©cut√© une fois la commande app:nom_de_commande excut√©


si vous taper la commande symfony console vous allez le voir dans la liste des commandes , ce qui prouve votre commande a √©t√© enregistr√©

et pour taper la commande on fait : symfony console app:create-administrator

lien pour cr√©er une commande symfony :  https://www.youtube.com/watch?v=IjJoA9IRzCE&list=PLUiuGjup8Vg5t20nu7aaJDnbHlhzXbbuN&index=39


_______________________________________________________
The cache component permet de faire une cache des ressources
pour l'installer : composer require symfony/cache



use Symfony\Component\Cache\Adapter\FilesystemAdapter;


        //on r√©cup√®re le cache
        //$cache = new FilesystemAdapter();

               //trick_key est la cl√© avec le quel le cache est identifi√©
       //la fonction callback va retourner l'item dans lequel se trouve le data et la dur√©e de la disponibilit√© du cache

       $data =  $cache->get('trick_key', function(ItemInterface $item) use ($trickRepository){
       $item->expiresAfter(35);
       return $trickRepository->trickByCategory();

       });


_______________________________________________________________

Event Listeners :
Event Listeners sont des evenements qu'on √©coute lors de diff√©rentes phase de l'ex√©cution de d'une application symfony
exemple : des evenements sont d√©clanch√©s lors d'une requette http


Subscribers : 
la principale diff√©rence entre Event Subscribers et les  Event Listeners est que les Event Subscribers connaissent d√©ja en avance les evenements qu'ils √©coutent



Event Listeners :
les events listeners par default de symfony sont beaucoups dont certains : 
kernel.request, kernel.controller, kernel.controller_arguments ect...





   cr√©er notre propre listeneur : 
   - symfony console make:listener  





  cr√©er notre propre listeneur Subscriber
   symfony console make:subscriber


        1- donner le nom de class de notre event listener ex: MaClassEcouterEvenement
        2- donner le event √† √©couter  ex : kernel.request (qui s'√©x√©cute apr√®s chaque requete)


resultat il va creer une class MaClassEcouterEvenement dans le quel il implemente : 
- la fonction onKernelRequest qui contient l'action apr√®s l'evenements
- la fonction getSubscribedEvents dans lequel il y'a le liste des evenements qu'on √©coute




_______________________________________________________Personnalis√© les pages d'erreurs________________________________________

1 - Installer composer require symfony/twig-pack si vous n'avez installer version webapp se symfony

2 - cr√©er ces fichiers dans l'arboresence comme ceci : 
templates/
‚îî‚îÄ bundles/
   ‚îî‚îÄ TwigBundle/
      ‚îî‚îÄ Exception/
         ‚îú‚îÄ error404.html.twig
         ‚îú‚îÄ error403.html.twig
         ‚îî‚îÄ error.html.twig      # All other HTML errors (including 500)


3 - fichier de config par default : 

# config/routes/framework.yaml
when@dev:
    _errors:
        resource: '@FrameworkBundle/Resources/config/routing/errors.xml'
        prefix:   /_error

4 - aller dans le fichier env. et mettre prod √† la place de dev (en.local si on veut tester en locale le comportement en production)

NB: pour tester la page on peut v√©rifi√© sur  : http://localhost/_error/{statusCode}

N'oublier pas √† chaque fois de vider le cache pour qu'il marche en mode prod




__________________________________________________________________________________________________________________________________




















SUPPRIMER UN PACKAGE SYMFONY AVEC COMPOSER



 composer remove TonPackage --update-with-dependencies --dev

 puis supprimer le TonPackage dans composer.json
 puis faire un composer update











____________________




<?php

/**
 * Returns the importmap for this application.
 *
 * - "path" is a path inside the asset mapper system. Use the
 *     "debug:asset-map" command to see the full list of paths.
 *
 * - "entrypoint" (JavaScript only) set to true for any module that will
 *     be used as an "entrypoint" (and passed to the importmap() Twig function).
 *
 * The "importmap:require" command can be used to add new entries to this file.
 */
return [
    'app' => [
        'path' => './assets/app.js',
        'entrypoint' => true,
    ],
    'register' => [
        'path' => './assets/js/register.js',
        'entrypoint' => true,
    ],
    'add-response-comment' => [
        'path' => './assets/js/addResponseComment.js',
        'entrypoint' => true,
    ],
    '@hotwired/stimulus' => [
        'version' => '3.2.2',
    ],
    '@symfony/stimulus-bundle' => [
        'path' => './vendor/symfony/stimulus-bundle/assets/dist/loader.js',
    ],
    '@hotwired/turbo' => [
        'version' => '8.0.12',
    ],
];




























document.addEventListener("turbo:load", function() {
    // Your JS code that should run after a full page load


//console.log("je suis dans le fichier js addResponseComment.js")

//selectionner tous les √©lements qui ont l'attribut data-reply
document.querySelectorAll("[data-reply]").forEach(element => {
    element.addEventListener("click", function(){
        console.log(this)
    })
})


});


































<?php

/**
 * Returns the importmap for this application.
 *
 * - "path" is a path inside the asset mapper system. Use the
 *     "debug:asset-map" command to see the full list of paths.
 *
 * - "entrypoint" (JavaScript only) set to true for any module that will
 *     be used as an "entrypoint" (and passed to the importmap() Twig function).
 *
 * The "importmap:require" command can be used to add new entries to this file.
 */
return [
    'app' => [
        'path' => './assets/app.js',
        'entrypoint' => true,
    ],
    'register' => [
        'path' => './assets/js/register.js',
        'entrypoint' => true,
    ],
    'add-response-comment' => [
        'path' => './assets/js/addResponseComment.js',
        'entrypoint' => true,
    ],
    '@hotwired/stimulus' => [
        'version' => '3.2.2',
    ],
    '@symfony/stimulus-bundle' => [
        'path' => './vendor/symfony/stimulus-bundle/assets/dist/loader.js',
    ],
    '@hotwired/turbo' => [
        'version' => '8.0.12',
    ],
];











import './bootstrap.js';
/*
 * Welcome to your app's main JavaScript file!
 *
 * This file will be included onto the page via the importmap() Twig function,
 * which should already be in your base.html.twig.
 */

//on importe le css app.css
import './styles/app.css';

//on importe le css bootstrap.min.css
import './styles/bootstrap.min.css';

//on importe le js scripts.js
import './js/scripts.js';


//importe le fichier js addResponseComment.js
import './js/addResponseComment.js';


//r√©cuperer le module
import { maj } from './js/my_module.js';

//console.log(maj("aladi"))

//console.log('This log comes from assets/app.js - welcome to AssetMapper! üéâ');